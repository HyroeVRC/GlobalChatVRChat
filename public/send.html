<!doctype html>
<meta charset="utf-8">
<title>GlobalChat — Envoyer</title>
<style>
  body { font: 16px system-ui; max-width: 480px; margin: 40px auto; }
  label { display:block; margin:.5rem 0 .25rem; }
  input, textarea, button { width:100%; padding:.6rem; }
  button { margin-top: .8rem; cursor:pointer; }
</style>
<h1>Envoyer un message</h1>
<form action="/send" method="GET" onsubmit="return onSend(this)">
  <label>World ID</label>
  <input name="worldId" value="wrld_c2b1a096-9f2b-474c-afb7-fece2e1ecdfa" required>

  <label>Channel</label>
  <input name="channel" value="global" required>

  <label>Nom</label>
  <input name="username" placeholder="Hyroe" required>

  <label>Message</label>
  <textarea name="text" maxlength="200" rows="3" required></textarea>

  <button type="submit">Envoyer</button>
  <p id="status"></p>
</form>
<script>
async function onSend(f){
  const params = new URLSearchParams(new FormData(f));
  const url = "/send?" + params.toString();
  const r = await fetch(url, { method: "GET", cache: "no-store" });
  const j = await r.json().catch(()=>({ok:false,error:"bad-json"}));
  document.getElementById("status").textContent = j.ok ? "OK" : ("Erreur: " + j.error);
  if(j.ok) f.text.value = "";  // vide le champ message
  return false; // évite de recharger la page
}
</script>
